## Как настроить маршрутизацию в приложении Next.js?

Маршрутизация (роутинг) в Next.js играет ключевую роль в создании многопользовательских веб-приложений, обеспечивая навигацию между различными страницами и компонентами. В Next.js существуют два основных подхода к настройке маршрутизации:

1. **Использование папки `pages`** (традиционный подход).
2. **Использование папки `app`** (новый подход, начиная с Next.js 13 и улучшенный в версии 14).

Рассмотрим каждый из этих подходов подробно.

---

## 1. Маршрутизация с использованием папки `pages`

### Основные концепции

До появления папки `app`, Next.js использовал **файловую маршрутизацию** на основе структуры файлов внутри папки `pages`. Этот подход остается актуальным и поддерживается для обеспечения обратной совместимости.

### Структура папки `pages`

Каждый файл внутри папки `pages` автоматически становится доступным как отдельный маршрут. Структура папки отражает структуру URL.

**Пример структуры:**
```
/pages
  |-- index.js        // Доступен по маршруту '/'
  |-- about.js        // Доступен по маршруту '/about'
  |-- blog
       |-- index.js   // Доступен по маршруту '/blog'
       |-- [id].js     // Доступен по маршруту '/blog/[id]'
```

### Динамические маршруты

Для создания динамических маршрутов используются квадратные скобки `[]`.

**Пример:**
```javascript
// pages/blog/[id].js
import { useRouter } from 'next/router';

const Post = () => {
  const router = useRouter();
  const { id } = router.query;

  return <h1>Пост ID: {id}</h1>;
};

export default Post;
```
Этот файл обрабатывает маршруты вида `/blog/1`, `/blog/2` и т.д., где `id` — динамический параметр.

### Вложенные маршруты

Создавая папки внутри `pages`, можно создавать вложенные маршруты.

**Пример:**
```
/pages
  |-- products
       |-- index.js    // Доступен по маршруту '/products'
       |-- [category]
            |-- [id].js // Доступен по маршруту '/products/[category]/[id]'
```

### API маршруты

Next.js позволяет создавать API-эндпоинты внутри папки `pages/api`.

**Пример:**
```javascript
// pages/api/hello.js
export default function handler(req, res) {
  res.status(200).json({ message: 'Привет от API!' });
}
```
Этот маршрут доступен по адресу `/api/hello` и может использоваться для обработки запросов данных.

### Ограничения подхода с `pages`

- **Отсутствие встроенных лейаутов**: Для создания общих элементов интерфейса (например, хедеров или футеров) необходимо использовать обёртки вручную.
- **Менее гибкая маршрутизация**: Вложенные маршруты могут быть ограничены по сравнению с новым подходом в папке `app`.

---

## 2. Маршрутизация с использованием папки `app` (Next.js 13 и 14)

С появлением папки `app` в Next.js 13, фреймворк предложил более современный и гибкий подход к маршрутизации, основанный на **React Server Components**, **лейаутах** и **вложенных маршрутах**.

### Основные концепции

- **Лейауты (Layouts)**: Позволяют создавать общие макеты для групп страниц.
- **Nested Routes (Вложенные маршруты)**: Поддерживают более сложные структуры страниц с повторным использованием компонентов.
- **React Server Components**: Оптимизированный рендеринг компонентов на сервере для повышения производительности.
- **File-based Routing**: Похож на подход с `pages`, но с улучшенной структурой и функциональностью.

### Структура папки `app`

**Пример структуры:**
```
/app
  |-- layout.js          // Общий лейаут для всего приложения
  |-- page.js            // Доступен по маршруту '/'
  |-- about
       |-- layout.js     // Лейаут для раздела '/about'
       |-- page.js       // Доступен по маршруту '/about'
  |-- blog
       |-- layout.js     // Лейаут для раздела '/blog'
       |-- page.js       // Доступен по маршруту '/blog'
       |-- [id]
            |-- page.js    // Доступен по маршруту '/blog/[id]'
```

### Лейауты (Layouts)

Лейауты позволяют определять общие элементы интерфейса, которые будут повторяться на разных страницах.

**Пример:**
```javascript
// app/layout.js
export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        <header>Мой Хедер</header>
        <main>{children}</main>
        <footer>Мой Футер</footer>
      </body>
    </html>
  );
}
```
Этот лейаут будет применяться ко всем страницам приложения.

### Динамические маршруты

Как и в папке `pages`, динамические маршруты создаются с помощью квадратных скобок.

**Пример:**
```javascript
// app/blog/[id]/page.js
import { useRouter } from 'next/router';

const Post = () => {
  const router = useRouter();
  const { id } = router.query;

  return <h1>Пост ID: {id}</h1>;
};

export default Post;
```

### Вложенные маршруты и лейауты

Позволяют создавать более сложные иерархии страниц с повторяющимися компонентами.

**Пример:**
```javascript
// app/dashboard/layout.js
export default function DashboardLayout({ children }) {
  return (
    <div>
      <nav>Навигация Dashboard</nav>
      <section>{children}</section>
    </div>
  );
}

// app/dashboard/page.js
const Dashboard = () => <h1>Добро пожаловать в Dashboard</h1>;

export default Dashboard;
```
Все страницы внутри `dashboard` будут использовать этот лейаут.

### Встроенные API маршруты

В папке `app` API маршруты обрабатываются отдельно, как и в папке `pages/api`.

**Пример:**
```javascript
// app/api/hello/route.js
export async function GET(request) {
  return new Response(JSON.stringify({ message: 'Привет от API!' }), {
    headers: { 'Content-Type': 'application/json' },
  });
}
```
Этот маршрут доступен по адресу `/api/hello`.

### Преимущества подхода с `app`

1. **Более гибкая и модульная структура**: Позволяет лучше организовать код и повторно использовать компоненты.
2. **Встроенные лейауты**: Упрощают создание общих элементов интерфейса.
3. **React Server Components**: Повышают производительность за счет рендеринга на сервере.
4. **Поддержка параллельного рендеринга**: Улучшает производительность и отзывчивость приложения.
5. **Улучшенная маршрутизация**: Более мощные возможности для создания сложных маршрутов и вложенных структур.

### Совместное использование `pages` и `app`

Next.js 13 и 14 позволяют использовать обе папки одновременно для обеспечения обратной совместимости. Однако рекомендуется постепенно переходить на новый подход с `app`, чтобы воспользоваться всеми его преимуществами.

---

## Практический пример настройки маршрутизации

### Использование папки `pages`

**Структура:**
```
/pages
  |-- index.js          // '/'
  |-- about.js          // '/about'
  |-- blog
       |-- [id].js       // '/blog/[id]'
```

**Пример страницы:**
```javascript
// pages/about.js
const About = () => {
  return <h1>О нас</h1>;
};

export default About;
```

**Динамическая страница:**
```javascript
// pages/blog/[id].js
import { useRouter } from 'next/router';

const Post = () => {
  const router = useRouter();
  const { id } = router.query;

  return <h1>Пост ID: {id}</h1>;
};

export default Post;
```

### Использование папки `app` (Next.js 13 и 14)

**Структура:**
```
/app
  |-- layout.js          // Общий лейаут
  |-- page.js            // '/'
  |-- about
       |-- page.js       // '/about'
  |-- blog
       |-- [id]
            |-- page.js    // '/blog/[id]'
```

**Пример общего лейаута:**
```javascript
// app/layout.js
export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        <header>Мой Хедер</header>
        <main>{children}</main>
        <footer>Мой Футер</footer>
      </body>
    </html>
  );
}
```

**Страница "About":**
```javascript
// app/about/page.js
const About = () => {
  return <h1>О нас</h1>;
};

export default About;
```

**Динамическая страница:**
```javascript
// app/blog/[id]/page.js
import { useRouter } from 'next/router';

const Post = () => {
  const router = useRouter();
  const { id } = router.query;

  return <h1>Пост ID: {id}</h1>;
};

export default Post;
```

---

## Заключение

Маршрутизация в Next.js предоставляет мощные и гибкие инструменты для создания современных веб-приложений. Переход от папки `pages` к папке `app` в версиях 13 и 14 позволяет разработчикам более эффективно организовывать код, использовать серверные компоненты и создавать сложные структуры маршрутов с минимальными усилиями.

**Рекомендации:**

- **Новые проекты**: Используйте папку `app` для получения всех преимуществ нового подхода.
- **Существующие проекты**: Постепенно переходите на папку `app`, чтобы воспользоваться улучшениями и обеспечить совместимость с будущими обновлениями.
- **Обратная совместимость**: Оба подхода могут использоваться одновременно, что облегчает миграцию.