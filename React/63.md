## Что такое побочные эффекты?

Cписок побочных эффектов в React:

1. Запросы к серверу (например, через `fetch` или `axios`).  
2. Работа с DOM (например, изменение заголовка страницы через `document.title`).  
3. Установка или очистка таймеров (`setTimeout`, `setInterval`).  
4. Подписки на события (например, `addEventListener`).  
5. Очистка ресурсов (например, отписка от событий или закрытие соединений WebSocket).  
6. Взаимодействие с внешними библиотеками (например, Chart.js, D3.js).  
7. Сохранение данных в локальное хранилище (`localStorage`, `sessionStorage`).  
8. Логирование или отправка аналитики.  
9. Анимации и их управление.  
10. Работа с внешними API (например, Google Maps).  

Они называются **побочными эффектами** (side effects), потому что:

1. **Не связаны напрямую с рендерингом:**  
   React-компоненты предназначены для вычисления и отображения UI на основе состояния и пропсов. Побочные эффекты происходят "в стороне" от этой основной задачи.

2. **Могут влиять на внешний мир:**  
   Например, обновление DOM, взаимодействие с сервером или внешними библиотеками изменяет состояние за пределами компонента, что выходит за рамки чистого вычисления интерфейса.

3. **Нарушают чистоту функций:**  
   Компоненты-функции в React по идее должны быть чистыми: на одном и том же наборе входных данных (пропсов) они должны выдавать одинаковый результат (JSX). Побочные эффекты нарушают это правило, так как они могут вызывать изменения вне компонента или зависеть от внешнего окружения.

4. **Требуют управления:**  
   Побочные эффекты могут вызвать ошибки (например, утечки памяти), если их не контролировать. Поэтому их изолируют и управляют ими с помощью специальных инструментов, таких как `useEffect`.

Таким образом, побочные эффекты — это операции, которые происходят вне самого компонента и могут затронуть его состояние, пользовательский интерфейс или внешние системы.

**Простые примеры побочных эффектов:**

---

### 1. **Запрос данных с сервера**
Компонент делает запрос к серверу для получения данных и сохраняет их в состояние.

```jsx
import React, { useState, useEffect } from "react";

function FetchData() {
  const [data, setData] = useState(null);

  useEffect(() => {
    fetch("https://jsonplaceholder.typicode.com/posts/1")
      .then((response) => response.json())
      .then((data) => setData(data));
  }, []); // Пустой массив зависимостей означает, что эффект выполнится один раз.

  return <div>{data ? data.title : "Loading..."}</div>;
}
```

---

### 2. **Изменение заголовка страницы**
Изменение содержимого `<title>` на основе состояния компонента.

```jsx
import React, { useState, useEffect } from "react";

function ChangeTitle() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    document.title = `Вы нажали ${count} раз`;
  }, [count]); // Эффект срабатывает при изменении `count`.

  return <button onClick={() => setCount(count + 1)}>Нажми {count}</button>;
}
```

---

### 3. **Подписка на событие**
Например, подписка на изменение размера окна и снятие подписки при размонтировании компонента.

```jsx
import React, { useState, useEffect } from "react";

function WindowWidth() {
  const [width, setWidth] = useState(window.innerWidth);

  useEffect(() => {
    const handleResize = () => setWidth(window.innerWidth);

    window.addEventListener("resize", handleResize);

    return () => {
      window.removeEventListener("resize", handleResize); // Очистка эффекта
    };
  }, []); // Пустой массив — подписываемся только при монтировании.

  return <div>Ширина окна: {width}px</div>;
}
```

---

### Почему это побочные эффекты?
Потому что они:
- Выполняются **вне рендера компонента**.
- Могут затрагивать внешние ресурсы или изменять состояние вне компонента.

В React не все операции считаются побочными эффектами. Чтобы определить, относится ли что-то к побочным эффектам, важно учитывать, что побочные эффекты — это операции, которые происходят **вне рендера** компонента и могут влиять на его окружение.

### **Что НЕ относится к побочным эффектам?**
1. **Чистые вычисления внутри рендера**  
   Любые операции, которые зависят только от входных данных (props, state) и возвращают результат без изменения внешнего окружения, не являются побочными эффектами.
   ```jsx
   function Square({ number }) {
     const result = number * number; // Чистое вычисление
     return <div>Квадрат: {result}</div>;
   }
   ```
   Здесь `number * number` — это чистая функция, а не побочный эффект.

---

2. **Изменение локального состояния**  
   Использование `useState` для обновления локального состояния через обработчики событий.
   ```jsx
   import React, { useState } from "react";

   function Counter() {
     const [count, setCount] = useState(0);

     return <button onClick={() => setCount(count + 1)}>Счетчик: {count}</button>;
   }
   ```
   Обновление состояния — это внутренняя реактивная механика React, и она не считается побочным эффектом.

---

3. **Рендеринг JSX**  
   Операция рендера (возврат JSX или React элементов) сама по себе не является побочным эффектом, поскольку это часть нормального потока работы React.
   ```jsx
   function Greeting() {
     return <h1>Привет, мир!</h1>;
   }
   ```

---

4. **Чтение из props или state**  
   Доступ к `props` или `state` для вычисления значения.
   ```jsx
   function Welcome({ name }) {
     return <h1>Добро пожаловать, {name}!</h1>;
   }
   ```
   Чтение данных — это не побочный эффект, так как оно не влияет на внешнее окружение.

---

### Признаки операций, которые не являются побочными эффектами:
- Они не зависят от внешнего мира (например, данных сервера, DOM).
- Они не изменяют внешние ресурсы или глобальное состояние.
- Они выполняются в рамках рендера без использования `useEffect` или подобных механизмов.

**Итог:**  
Операции, которые являются частью чистой логики компонента (вычисления, рендеринг, обновление состояния), **не считаются побочными эффектами**.

Пример React-компонента, который выполняет только чистые вычисления и не использует побочные эффекты:

```jsx
import React from "react";

function SumOfSquares({ numbers }) {
  // Чистое вычисление: сумма квадратов чисел
  const sum = numbers.reduce((acc, num) => acc + num ** 2, 0);

  // Рендеринг результата
  return (
    <div>
      <h3>Сумма квадратов:</h3>
      <p>{sum}</p>
    </div>
  );
}

export default SumOfSquares;
```

---

### Объяснение, почему это **без побочных эффектов**:
1. **Чистое вычисление:**  
   - Вычисление суммы квадратов зависит только от входных данных (`numbers`).
   - Не изменяет глобальное состояние или внешние ресурсы.

2. **Рендеринг JSX:**  
   - Просто возвращает JSX на основе результата вычислений.

3. **Нет взаимодействия с внешним окружением:**  
   - Нет запросов к серверу.
   - Нет подписок или манипуляций с DOM.
   - Нет использования `useEffect`.

**`console.log`** является побочным эффектом.  

### Почему?
Побочные эффекты — это любые операции, которые:
1. Влияют на внешнюю среду.
2. Не связаны напрямую с вычислениями или рендерингом в React.

### Признаки побочного эффекта у `console.log`:
- **Изменение внешнего окружения:**  
  `console.log` выводит информацию в консоль браузера или терминала, что является взаимодействием с внешней системой.
- **Не детерминированное поведение:**  
  Результат вызова `console.log` (вывод в консоль) не влияет на вычисления программы, но изменяет состояние окружения (например, добавляет запись в консоль).
