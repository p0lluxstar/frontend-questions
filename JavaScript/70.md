## Разница между микро и макрозадачами в event loop?

В контексте JavaScript и цикла событий (event loop) существует две основные категории задач: **макрозадачи** и **микрозадачи**. Они различаются по приоритету и способу обработки в очереди.

### Макрозадачи (Macrotasks)
- **Определение**: Макрозадачи — это более крупные единицы работы, которые обрабатываются циклом событий.
- **Примеры**:
  - `setTimeout()`
  - `setInterval()`
  - Обработчики событий (например, события клика, ввода и т. д.)
  - Запросы на выполнение в Web API (например, `XMLHttpRequest`)
- **Обработка**: 
  - Когда стек вызовов пуст, цикл событий берет следующую макрозадачу из очереди и помещает её в стек вызовов для выполнения. 
  - После выполнения макрозадачи цикл событий проверяет, есть ли в очереди микрозадачи, и если да, то обрабатывает их, прежде чем перейти к следующей макрозадаче.

### Микрозадачи (Microtasks)
- **Определение**: Микрозадачи — это более мелкие задачи, которые обычно выполняются сразу после текущей макрозадачи и перед переходом к следующей макрозадаче.
- **Примеры**:
  - `Promise.then()`
  - `Promise.catch()`
  - `MutationObserver`
- **Обработка**:
  - Микрозадачи имеют более высокий приоритет, чем макрозадачи. После выполнения макрозадачи цикл событий проверяет очередь микрозадач и выполняет их, пока она не станет пустой, прежде чем вернуться к очереди макрозадач.

### Пример

```javascript
console.log('Start');

setTimeout(() => {
    console.log('Macrotask 1');
}, 0);

Promise.resolve().then(() => {
    console.log('Microtask 1');
});

setTimeout(() => {
    console.log('Macrotask 2');
}, 0);

Promise.resolve().then(() => {
    console.log('Microtask 2');
});

console.log('End');
```

**Вывод**:
```
Start
End
Microtask 1
Microtask 2
Macrotask 1
Macrotask 2
```

### Объяснение вывода:
1. Сначала выполняются синхронные задачи (`console.log('Start')` и `console.log('End')`).
2. Затем обработчик первого промиса (`Promise.resolve().then(...)`), который добавляет микрозадачу, выполняется сразу после текущей макрозадачи.
3. Обрабатывается второй промис, добавляя вторую микрозадачу.
4. После того как все микрозадачи выполнены, цикл событий переходит к первой макрозадаче и выполняет её, затем выполняет вторую макрозадачу.

### Заключение
Таким образом, микрозадачи выполняются с более высоким приоритетом и до выполнения следующей макрозадачи. Это позволяет более эффективно обрабатывать асинхронные операции и улучшает отзывчивость приложений.